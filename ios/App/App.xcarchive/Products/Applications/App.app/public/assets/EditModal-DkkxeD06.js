import{j as e,h as P,s as U,C as W,M as X,i as z,k as q,l as J}from"./index-DuWVAYsy.js";import{r as i}from"./dnd-kit-CCR-p5D8.js";import"./vendor-024GqXKi.js";const K=({currentAudio:p,onSave:w,onRemove:D})=>{const[j,S]=i.useState(!1),[t,I]=i.useState(p||null),[N,f]=i.useState(0),l=i.useRef(null),m=i.useRef([]),x=i.useRef(null);i.useEffect(()=>{p!==t&&setTimeout(()=>I(p||null),0)},[p,t]);const A=()=>{const n=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"];for(const g of n)if(MediaRecorder.isTypeSupported(g))return g;return""},C=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Not supported");return}const n=await navigator.mediaDevices.getUserMedia({audio:!0}),g=A();try{l.current=new MediaRecorder(n,g?{mimeType:g}:{})}catch{l.current=new MediaRecorder(n)}m.current=[],l.current.ondataavailable=d=>{d.data.size>0&&m.current.push(d.data)},l.current.onstop=()=>{const d=new Blob(m.current,{type:l.current.mimeType||"audio/webm"}),v=new FileReader;v.onloadend=()=>{I(v.result),w(v.result)},v.readAsDataURL(d),n.getTracks().forEach(F=>F.stop())},l.current.start(),S(!0),f(0),x.current=setInterval(()=>f(d=>d+1),1e3)}catch(n){console.error(n),alert("Allow mic access")}},R=()=>{l.current&&j&&(l.current.stop(),S(!1),clearInterval(x.current))},y=()=>{t&&new Audio(t).play()},k=()=>{I(null),D()},M=n=>`${Math.floor(n/60)}:${(n%60).toString().padStart(2,"0")}`;return e.jsxs("div",{style:{background:"#f8f8f8",padding:"0.75rem",borderRadius:"0.75rem",display:"flex",flexDirection:"column",gap:"0.625rem"},children:[e.jsx("div",{role:"status","aria-live":"polite",style:{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"},children:j?"Recording started":t&&!j?"Recording stopped":""}),e.jsx("label",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Custom Voice"}),j?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.625rem"},children:[e.jsx("div",{style:{width:"0.75rem",height:"0.75rem",borderRadius:"50%",background:"#FF3B30",animation:"pulse 1s infinite"}}),e.jsxs("span",{style:{flex:1,fontWeight:"bold",color:"#FF3B30"},children:["Recording... ",M(N)]}),e.jsx("button",{onClick:R,style:{padding:"0.5rem 1rem",background:"#FF3B30",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:"bold",minHeight:"2.75rem"},children:"â¹ Stop"})]}):t?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:y,style:{flex:1,padding:"0.5rem",background:"#007AFF",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",minHeight:"2.75rem"},children:"â–¶ï¸ Play"}),e.jsx("button",{onClick:C,style:{flex:1,padding:"0.5rem",background:"#34C759",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",minHeight:"2.75rem"},children:"ðŸ”„ Re-record"}),e.jsx("button",{onClick:k,style:{padding:"0.5rem 0.75rem",background:"#FF3B30",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",minHeight:"2.75rem",minWidth:"2.75rem"},children:"ðŸ—‘ï¸"})]}):e.jsx("button",{onClick:C,style:{padding:"0.625rem",background:"#FF3B30",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",minHeight:"2.75rem"},children:"ðŸŽ¤ Record Voice"})]})},O=({isOpen:p,onClose:w,onSave:D,onDelete:j,onOpenEmojiPicker:S,item:t,triggerPaywall:I})=>{const[N,f]=i.useState(""),[l,m]=i.useState(""),[x,A]=i.useState(""),[C,R]=i.useState("grid"),[y,k]=i.useState(null),[M,n]=i.useState(!1),[g,d]=i.useState(!1),[v,F]=i.useState(!1),[L,T]=i.useState(null),$=i.useRef(null),V=i.useRef(null),E=i.useRef(null);i.useEffect(()=>{p&&t&&t.id!==E.current&&(E.current=t.id,(async()=>{let s=t.icon,a=t.customAudio;if(typeof t.icon=="string"&&t.icon.startsWith("db:")){const o=t.icon.split(":")[1];s=await z(o)}if(typeof t.customAudio=="string"&&t.customAudio.startsWith("db:")){const o=t.customAudio.split(":")[1];a=await z(o)}f(t.word),m(s),A(t.bgColor||""),R(t.viewMode||"grid"),k(a),T(t.characterConfig||null),n(typeof s=="string"&&(s.startsWith("/")||s.startsWith("data:")||s.includes(".")))})())},[p,t]);const H=r=>{const s=r.target.files[0];s&&G(s)},G=r=>{if(r instanceof Blob){d(!0);const s=new FileReader;s.onload=a=>{const o=new Image;o.onload=()=>{const h=document.createElement("canvas"),u=512;let c=o.width,b=o.height;c>b?c>u&&(b*=u/c,c=u):b>u&&(c*=u/b,b=u),h.width=c,h.height=b,h.getContext("2d").drawImage(o,0,0,c,b),m(h.toDataURL("image/jpeg",.7)),n(!0),d(!1)},o.onerror=()=>d(!1),o.src=a.target.result},s.onerror=()=>d(!1),s.readAsDataURL(r)}else m(r),n(!0)},B=async(r=W.Prompt)=>{try{const s=await q.getPhoto({quality:90,allowEditing:!0,resultType:J.DataUrl,source:r});if(s&&s.dataUrl){d(!0);const a=new Image;a.onload=()=>{const o=document.createElement("canvas"),h=512;let u=a.width,c=a.height;u>c?u>h&&(c*=h/u,u=h):c>h&&(u*=h/c,c=h),o.width=u,o.height=c,o.getContext("2d").drawImage(a,0,0,u,c),m(o.toDataURL("image/jpeg",.7)),n(!0),d(!1)},a.onerror=()=>d(!1),a.src=s.dataUrl}}catch(s){console.error("Camera error:",s),d(!1)}};return p?e.jsx("div",{className:"ios-bottom-sheet-overlay",onClick:w,children:e.jsxs("div",{className:"ios-bottom-sheet",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"ios-sheet-header",children:[e.jsx("button",{className:"ios-cancel-button",onClick:w,children:"Cancel"}),e.jsx("h2",{className:"ios-sheet-title",children:t?.type==="folder"?"Edit Folder":"Edit Button"}),e.jsx("button",{className:"ios-done-button",disabled:g,style:{opacity:g?.5:1},onClick:async()=>{let r=l,s=y;if(typeof l=="string"&&l.startsWith("data:")){if(typeof t.icon=="string"&&t.icon.startsWith("db:")){const o=t.icon.split(":")[1];await P(o)}const a=`img-${Date.now()}`;await U(a,l),r=`db:${a}`}if(typeof y=="string"&&y.startsWith("data:")){if(typeof t.customAudio=="string"&&t.customAudio.startsWith("db:")){const o=t.customAudio.split(":")[1];await P(o)}const a=`audio-${Date.now()}`;await U(a,y),s=`db:${a}`}D(N,r,x,C,s,L),w()},children:g?"...":"Done"})]}),e.jsxs("div",{className:"ios-sheet-content",style:{background:"#F2F2F7"},children:[e.jsx("div",{className:"ios-setting-group-header",children:"Content"}),e.jsxs("div",{className:"ios-setting-card",children:[e.jsxs("div",{className:"ios-row",children:[e.jsx("span",{style:{fontWeight:600},children:"Label"}),e.jsx("input",{type:"text",value:N,onChange:r=>f(r.target.value),style:{border:"none",textAlign:"right",fontSize:"1.0625rem",outline:"none",background:"transparent",flex:1,minHeight:"2.75rem"},placeholder:"Enter label"})]}),t?.type==="folder"&&e.jsxs("div",{className:"ios-row",style:{flexDirection:"column",alignItems:"stretch",gap:"0.625rem",padding:"1rem"},children:[e.jsx("span",{style:{fontWeight:600,fontSize:"0.8125rem",textTransform:"uppercase",color:"#6e6e73"},children:"View Mode"}),e.jsxs("div",{className:"ios-segmented-control",style:{marginBottom:0},children:[e.jsx("div",{className:"selection-pill",style:{width:"calc(50% - 4px)",transform:C==="grid"?"translateX(0)":"translateX(100%)"}}),e.jsx("button",{onClick:()=>R("grid"),style:{minHeight:"2.75rem"},children:"Grid"}),e.jsx("button",{onClick:()=>R("schedule"),style:{minHeight:"2.75rem"},children:"Schedule"})]})]})]}),e.jsx("div",{className:"ios-setting-group-header",children:"Appearance"}),e.jsxs("div",{className:"ios-setting-card",children:[e.jsxs("div",{style:{padding:"1.25rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{style:{width:"6.25rem",height:"6.25rem",borderRadius:"22%",background:x||"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3.5rem",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:M?e.jsx("img",{src:l,alt:"preview",style:{width:"100%",height:"100%",objectFit:"contain"}}):l}),e.jsx("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",justifyContent:"center"},children:["","#FF3B30","#FF9500","#FFCC00","#34C759","#007AFF","#5556D6","#AF52DE"].map(r=>e.jsx("button",{onClick:()=>A(r),style:{width:"2.75rem",height:"2.75rem",borderRadius:"50%",background:r||"white",border:x===r?"3px solid #007AFF":"1px solid #ddd",cursor:"pointer",boxShadow:x===r?"0 0 0 2px white":"none"}},r))})]}),e.jsxs("div",{className:"ios-row",onClick:()=>S(f,(r,s)=>{m(r),n(!!s)}),style:{minHeight:"3rem"},children:[e.jsx("span",{children:"Choose from Library"}),e.jsx("span",{className:"ios-chevron",children:"â€º"})]}),e.jsxs("div",{className:"ios-row",onClick:()=>F(!0),style:{minHeight:"3rem"},children:[e.jsx("span",{children:"Select Character"}),e.jsx("span",{className:"ios-chevron",children:"â€º"})]}),e.jsxs("div",{className:"ios-row",onClick:()=>B(W.Camera),style:{minHeight:"3rem"},children:[e.jsx("span",{children:"ðŸ“· Take Photo"}),e.jsx("span",{className:"ios-chevron",children:"â€º"})]}),e.jsxs("div",{className:"ios-row",onClick:()=>B(W.Photos),style:{minHeight:"3rem"},children:[e.jsx("span",{children:"ðŸ–¼ï¸ Choose from Gallery"}),e.jsx("span",{className:"ios-chevron",children:"â€º"})]})]}),e.jsx("div",{className:"ios-setting-group-header",children:"Media"}),e.jsx("div",{className:"ios-setting-card",children:e.jsx("div",{style:{padding:"0.3125rem"},children:t?.type!=="folder"&&e.jsx(K,{currentAudio:y,onSave:r=>k(r),onRemove:()=>k(null)})})}),e.jsx("div",{style:{marginTop:"1.25rem"},children:e.jsx("button",{onClick:()=>{window.confirm("Delete this item?")&&(j(),w())},className:"ios-row",style:{width:"100%",border:"none",borderRadius:"0.75rem",justifyContent:"center",minHeight:"3rem"},children:e.jsx("span",{style:{color:"#FF3B30",fontWeight:600},children:"Delete Item"})})}),e.jsx("input",{type:"file",ref:$,onChange:H,accept:"image/*",style:{display:"none"}}),e.jsx("input",{type:"file",ref:V,onChange:H,accept:"image/*",capture:"environment",style:{display:"none"}})]}),v&&e.jsx(X,{onSelect:(r,s)=>{m(r),T(s),s.name&&f(s.name),n(!0),F(!1)},onClose:()=>F(!1)})]})}):null};export{O as default};
//# sourceMappingURL=EditModal-DkkxeD06.js.map
