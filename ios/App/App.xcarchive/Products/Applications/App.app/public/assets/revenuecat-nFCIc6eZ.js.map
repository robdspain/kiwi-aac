{"version":3,"file":"revenuecat-nFCIc6eZ.js","sources":["../../src/plugins/revenuecat.ts"],"sourcesContent":["import { Purchases, LOG_LEVEL } from '@revenuecat/purchases-capacitor';\nimport { RevenueCatUI } from '@revenuecat/purchases-capacitor-ui';\n\nexport interface RevenueCatPlugin {\n  /**\n   * Configure RevenueCat with API key\n   */\n  configure(options: { apiKey: string; appUserID?: string }): Promise<void>;\n\n  /**\n   * Get customer info (subscription status)\n   */\n  getCustomerInfo(): Promise<{\n    activeSubscriptions: string[];\n    allPurchasedProductIdentifiers: string[];\n    entitlements: Record<string, { isActive: boolean }>;\n  }>;\n\n  /**\n   * Get available offerings (products/paywalls)\n   */\n  getOfferings(): Promise<{\n    current: {\n      availablePackages: Array<{\n        identifier: string;\n        product: {\n          identifier: string;\n          description: string;\n          title: string;\n          price: string;\n          priceString: string;\n        };\n      }>;\n    };\n  }>;\n\n  /**\n   * Purchase a package\n   */\n  purchasePackage(options: { packageIdentifier: string }): Promise<{\n    customerInfo: any;\n    productIdentifier: string;\n  }>;\n\n  /**\n   * Restore purchases\n   */\n  restorePurchases(): Promise<{\n    customerInfo: any;\n  }>;\n\n  /**\n   * Check if user has an active entitlement\n   */\n  checkEntitlement(entitlementId: string): Promise<boolean>;\n\n  /**\n   * Present native paywall UI\n   */\n  presentPaywall(options?: { offering?: string }): Promise<{\n    customerInfo: any;\n  }>;\n\n  /**\n   * Present native paywall if needed (only shows if user doesn't have entitlement)\n   */\n  presentPaywallIfNeeded(options: {\n    requiredEntitlementIdentifier: string;\n    offering?: string;\n  }): Promise<{\n    customerInfo: any;\n  }>;\n\n  /**\n   * Present Customer Center (manage subscriptions)\n   */\n  presentCustomerCenter(): Promise<void>;\n}\n\n// Lazy initialization to prevent circular dependencies\nlet revenueCatInstance: RevenueCatPlugin | null = null;\nlet isConfigured = false;\n\nexport const getRevenueCat = (): RevenueCatPlugin => {\n  if (!revenueCatInstance) {\n    revenueCatInstance = {\n      configure: async (options) => {\n        if (!isConfigured) {\n          try {\n            await Purchases.setLogLevel({ level: LOG_LEVEL.DEBUG });\n            await Purchases.configure({\n              apiKey: options.apiKey || (import.meta.env.VITE_REVENUECAT_API_KEY || 'test_GVsVAPHELhFcgnBFbWlVyrYGiUS'),\n              appUserID: options.appUserID,\n            });\n            isConfigured = true;\n            console.log('RevenueCat configured successfully');\n          } catch (error) {\n            console.error('RevenueCat configuration error:', error);\n          }\n        }\n      },\n\n      getCustomerInfo: async () => {\n        const { customerInfo } = await Purchases.getCustomerInfo();\n        return {\n          activeSubscriptions: customerInfo.activeSubscriptions,\n          allPurchasedProductIdentifiers: customerInfo.allPurchasedProductIdentifiers,\n          entitlements: customerInfo.entitlements.active,\n        };\n      },\n\n      getOfferings: async () => {\n        const { offerings } = await Purchases.getOfferings();\n        return {\n          current: {\n            availablePackages: offerings.current?.availablePackages || [],\n          },\n        };\n      },\n\n      purchasePackage: async (options) => {\n        // Get the package from offerings first\n        const { offerings } = await Purchases.getOfferings();\n        const pkg = offerings.current?.availablePackages.find(\n          (p) => p.identifier === options.packageIdentifier\n        );\n\n        if (!pkg) {\n          throw new Error(`Package ${options.packageIdentifier} not found`);\n        }\n\n        const result = await Purchases.purchasePackage({ aPackage: pkg });\n        return {\n          customerInfo: result.customerInfo,\n          productIdentifier: result.productIdentifier,\n        };\n      },\n\n      restorePurchases: async () => {\n        const result = await Purchases.restorePurchases();\n        return {\n          customerInfo: result.customerInfo,\n        };\n      },\n\n      checkEntitlement: async (entitlementId: string) => {\n        try {\n          const { customerInfo } = await Purchases.getCustomerInfo();\n          const entitlement = customerInfo.entitlements.active[entitlementId];\n          return entitlement?.isActive || false;\n        } catch (error) {\n          console.error('Error checking entitlement:', error);\n          return false;\n        }\n      },\n\n      presentPaywall: async (options = {}) => {\n        try {\n          const result = await RevenueCatUI.presentPaywall({\n            offering: options.offering,\n          });\n          return {\n            customerInfo: result.customerInfo,\n          };\n        } catch (error) {\n          console.error('Error presenting paywall:', error);\n          throw error;\n        }\n      },\n\n      presentPaywallIfNeeded: async (options) => {\n        try {\n          const result = await RevenueCatUI.presentPaywallIfNeeded({\n            requiredEntitlementIdentifier: options.requiredEntitlementIdentifier,\n            offering: options.offering,\n          });\n          return {\n            customerInfo: result.customerInfo,\n          };\n        } catch (error) {\n          console.error('Error presenting paywall if needed:', error);\n          throw error;\n        }\n      },\n\n      presentCustomerCenter: async () => {\n        try {\n          await RevenueCatUI.presentCustomerCenter();\n        } catch (error) {\n          console.error('Error presenting customer center:', error);\n          throw error;\n        }\n      },\n    };\n  }\n  return revenueCatInstance;\n};\n\n// Export the getter, NOT the instance\nexport default { get: getRevenueCat };\n"],"names":["revenueCatInstance","isConfigured","getRevenueCat","options","Purchases","LOG_LEVEL","error","customerInfo","offerings","pkg","p","result","entitlementId","RevenueCatUI","revenuecat"],"mappings":"iHAgFA,IAAIA,EAA8C,KAC9CC,EAAe,GAEZ,MAAMC,EAAgB,KACtBF,IACHA,EAAqB,CACnB,UAAW,MAAOG,GAAY,CAC5B,GAAI,CAACF,EACH,GAAI,CACF,MAAMG,EAAU,YAAY,CAAE,MAAOC,EAAU,MAAO,EACtD,MAAMD,EAAU,UAAU,CACxB,OAAQD,EAAQ,QAAW,mCAC3B,UAAWA,EAAQ,SAAA,CACpB,EACDF,EAAe,GACf,QAAQ,IAAI,oCAAoC,CAClD,OAASK,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CAEJ,EAEA,gBAAiB,SAAY,CAC3B,KAAM,CAAE,aAAAC,CAAA,EAAiB,MAAMH,EAAU,gBAAA,EACzC,MAAO,CACL,oBAAqBG,EAAa,oBAClC,+BAAgCA,EAAa,+BAC7C,aAAcA,EAAa,aAAa,MAAA,CAE5C,EAEA,aAAc,SAAY,CACxB,KAAM,CAAE,UAAAC,CAAA,EAAc,MAAMJ,EAAU,aAAA,EACtC,MAAO,CACL,QAAS,CACP,kBAAmBI,EAAU,SAAS,mBAAqB,CAAA,CAAC,CAC9D,CAEJ,EAEA,gBAAiB,MAAOL,GAAY,CAElC,KAAM,CAAE,UAAAK,CAAA,EAAc,MAAMJ,EAAU,aAAA,EAChCK,EAAMD,EAAU,SAAS,kBAAkB,KAC9CE,GAAMA,EAAE,aAAeP,EAAQ,iBAAA,EAGlC,GAAI,CAACM,EACH,MAAM,IAAI,MAAM,WAAWN,EAAQ,iBAAiB,YAAY,EAGlE,MAAMQ,EAAS,MAAMP,EAAU,gBAAgB,CAAE,SAAUK,EAAK,EAChE,MAAO,CACL,aAAcE,EAAO,aACrB,kBAAmBA,EAAO,iBAAA,CAE9B,EAEA,iBAAkB,UAET,CACL,cAFa,MAAMP,EAAU,iBAAA,GAER,YAAA,GAIzB,iBAAkB,MAAOQ,GAA0B,CACjD,GAAI,CACF,KAAM,CAAE,aAAAL,CAAA,EAAiB,MAAMH,EAAU,gBAAA,EAEzC,OADoBG,EAAa,aAAa,OAAOK,CAAa,GAC9C,UAAY,EAClC,OAASN,EAAO,CACd,eAAQ,MAAM,8BAA+BA,CAAK,EAC3C,EACT,CACF,EAEA,eAAgB,MAAOH,EAAU,KAAO,CACtC,GAAI,CAIF,MAAO,CACL,cAJa,MAAMU,EAAa,eAAe,CAC/C,SAAUV,EAAQ,QAAA,CACnB,GAEsB,YAAA,CAEzB,OAASG,EAAO,CACd,cAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,CACR,CACF,EAEA,uBAAwB,MAAOH,GAAY,CACzC,GAAI,CAKF,MAAO,CACL,cALa,MAAMU,EAAa,uBAAuB,CACvD,8BAA+BV,EAAQ,8BACvC,SAAUA,EAAQ,QAAA,CACnB,GAEsB,YAAA,CAEzB,OAASG,EAAO,CACd,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,CACR,CACF,EAEA,sBAAuB,SAAY,CACjC,GAAI,CACF,MAAMO,EAAa,sBAAA,CACrB,OAASP,EAAO,CACd,cAAQ,MAAM,oCAAqCA,CAAK,EAClDA,CACR,CACF,CAAA,GAGGN,GAITc,EAAe,CAAE,IAAKZ,CAAA"}